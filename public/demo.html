<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Horoskop-Tester – Chart API</title>
  <style>
    :root { color-scheme: light dark; }

    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      overflow-x: hidden;
    }

    header {
      padding: 18px 20px;
      border-bottom: 1px solid rgba(127,127,127,.35);
    }

    /* max width container, no overflow */
    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
    }

    /* 2 columns on wide screens, stacked on smaller */
    .layout {
      display: grid;
      grid-template-columns: 460px 1fr;
      gap: 16px;
      align-items: start;
    }
    @media (max-width: 1100px) {
      .layout { grid-template-columns: 1fr; }
    }

    .card {
      border: 1px solid rgba(127,127,127,.35);
      border-radius: 14px;
      padding: 14px;
      min-width: 0; /* prevents grid overflow */
    }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .row3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
    @media (max-width: 560px) {
      .row, .row3 { grid-template-columns: 1fr; }
    }

    label { display: block; font-size: 12px; opacity: .85; margin: 0 0 6px; }
    input, select, textarea {
      width: 100%;
      padding: 10px 10px;
      border-radius: 10px;
      border: 1px solid rgba(127,127,127,.45);
      background: transparent;
      color: inherit;
    }

    button {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(127,127,127,.45);
      background: transparent;
      color: inherit;
      cursor: pointer;
      white-space: nowrap;
    }
    button.primary { border-color: rgba(127,127,127,.75); font-weight: 600; }
    button:disabled { opacity: .6; cursor: not-allowed; }

    .actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .hint { font-size: 12px; opacity: .8; }
    .error { color: #c23; font-weight: 600; }
    .ok { color: #2a7; font-weight: 600; }

    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }

    .kv {
      display: grid;
      grid-template-columns: 190px 1fr;
      gap: 8px 10px;
      font-size: 13px;
      margin-top: 10px;
    }
    @media (max-width: 560px) {
      .kv { grid-template-columns: 1fr; }
      .kv div:nth-child(odd) { font-weight: 700; opacity: 1; margin-top: 8px; }
    }

    .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    .chip { border: 1px solid rgba(127,127,127,.45); border-radius: 999px; padding: 6px 10px; font-size: 12px; }

    .sectionTitle { font-weight: 700; margin: 14px 0 8px; }
    pre {
      white-space: pre-wrap;
      word-break: break-word;
      margin: 0;
      font-size: 12px;
      line-height: 1.35;
    }

    .grid2 { display: grid; grid-template-columns: 1fr; gap: 16px; }

    .panel {
      border: 1px solid rgba(127,127,127,.25);
      border-radius: 12px;
      padding: 12px;
      min-width: 0;
    }

    /* Tables don't blow up width: scroll inside */
    .tableWrap {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      border: 1px solid rgba(127,127,127,.20);
      border-radius: 12px;
    }
    table { width: 100%; border-collapse: collapse; font-size: 13px; min-width: 520px; }
    th, td { border-bottom: 1px solid rgba(127,127,127,.25); padding: 8px 6px; text-align: left; }
    th { opacity: .85; font-size: 12px; }

    /* Wheel */
    .wheelWrap { display: grid; gap: 10px; }
    canvas {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 12px;
      border: 1px solid rgba(127,127,127,.25);
      max-width: 520px;
      justify-self: start;
    }

    .legend { display:flex; gap:10px; flex-wrap:wrap; }
    .legendItem { display:flex; gap:8px; align-items:center; font-size:12px; opacity:.9; }
    .swatch { width: 12px; height: 12px; border-radius: 999px; border: 1px solid rgba(127,127,127,.6); }
    .sw-main { background: rgba(240,240,240,.95); }
    .sw-planet { background: rgba(190,190,190,.95); }
    .sw-angle { background: rgba(120,120,120,.95); }

    .controlsLine {
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap: wrap;
    }
    .checkboxLine { display:flex; gap:8px; align-items:center; font-size:12px; opacity:.9; }

    details { border: 1px solid rgba(127,127,127,.25); border-radius: 12px; padding: 10px 12px; }
    summary { cursor: pointer; font-weight: 700; }
    details > div { margin-top: 10px; font-size: 12px; opacity: .85; }
  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <div style="display:flex; justify-content:space-between; align-items:flex-end; gap:12px; flex-wrap:wrap;">
        <div>
          <div style="font-weight:700; font-size:16px;">Horoskop-Tester</div>
          <div class="hint">
            Anfrage an <span class="mono">POST /v1/astro/chart</span> – Ergebnisse + klare Visualisierung.
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="layout">
      <!-- LEFT: Inputs -->
      <section class="card">
        <div class="row">
          <div>
            <label for="baseUrl">API Basis-URL</label>
            <input id="baseUrl"/>
            <div class="hint" style="margin-top:6px;">Beispiel: <span class="mono">http://localhost:3000</span></div>
          </div>
          <div>
            <label for="endpoint">Endpoint</label>
            <input id="endpoint" value="/v1/astro/chart" />
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div>
            <label for="date">Datum (JJJJ-MM-TT)</label>
            <input id="date" value="1998-07-12" />
          </div>
          <div>
            <label for="time">Uhrzeit (HH:mm)</label>
            <input id="time" value="14:35" />
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div>
            <label for="lat">Breitengrad (Latitude)</label>
            <input id="lat" type="number" step="0.01" value="50.94" />
          </div>
          <div>
            <label for="lon">Längengrad (Longitude)</label>
            <input id="lon" type="number" step="0.01" value="6.96" />
          </div>
        </div>

        <div class="row3" style="margin-top:10px;">
          <div>
            <label for="tz">Zeitzone (optional)</label>
            <input id="tz" value="Europe/Berlin" />
            <div class="hint" style="margin-top:6px;">Wenn leer: Zeitzone wird aus Koordinaten abgeleitet.</div>
          </div>
          <div>
            <label for="houseSystem">Häusersystem</label>
            <select id="houseSystem">
              <option value="" selected>(Standard)</option>
              <option value="P">Placidus</option>
              <option value="K">Koch</option>
              <option value="R">Regiomontanus</option>
              <option value="C">Campanus</option>
              <option value="E">Gleiches Haus (Equal)</option>
              <option value="W">Ganzes Zeichen (Whole Sign)</option>
            </select>
          </div>
          <div>
            <label for="apiKey">API-Schlüssel (optional)</label>
            <input id="apiKey" placeholder="Bearer ..." />
          </div>
        </div>

        <div class="actions">
          <button class="primary" id="btnRun">Berechnen</button>
          <button id="btnFillExample">Beispiel setzen</button>
          <button id="btnCopyJson">JSON kopieren</button>
          <button id="btnCopyCurl">curl kopieren</button>
          <span id="status" class="hint"></span>
        </div>

        <div style="margin-top:12px;">
          <label for="requestPreview">Request JSON</label>
          <textarea id="requestPreview" rows="9" spellcheck="false"></textarea>
          <div class="hint" style="margin-top:6px;">Du kannst das JSON hier bearbeiten.</div>
        </div>

        <details style="margin-top:12px;">
          <summary>Kurzer Überblick: Was kommt zurück?</summary>
          <div>
            <div><b>Aszendent</b>: Zeichen + Grad, außerdem Längengrad (0–360).</div>
            <div><b>Medium Coeli</b>: höchster Punkt am Himmel (wenn du ihn in der API lieferst).</div>
            <div><b>Planeten</b>: ekliptische Längengrade, umgerechnet in Zeichen/Grad.</div>
            <div><b>Häuser</b>: 12 Hausspitzen (Cusp 1–12).</div>
            <div><b>Chartherrscher</b>: Herrscherplanet des Aszendent-Zeichens.</div>
          </div>
        </details>
      </section>

      <!-- RIGHT: Output -->
      <section class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
          <div style="font-weight:700;">Ergebnis</div>
          <div class="hint" id="httpMeta"></div>
        </div>

        <div class="kv" id="summary"></div>
        <div class="chips" id="chips"></div>

        <div class="grid2" style="margin-top:14px;">
          <div class="panel">
            <div class="controlsLine">
              <div style="font-weight:700;">Zodiak-Rad</div>
              <label class="checkboxLine">
                <input id="toggleHouses" type="checkbox" checked />
                Häuser anzeigen
              </label>
              <label class="checkboxLine">
                <input id="toggleAllPlanets" type="checkbox" checked />
                alle Planeten
              </label>
            </div>

            <div class="wheelWrap" style="margin-top:10px;">
              <canvas id="wheel" width="700" height="700"></canvas>

              <div class="legend">
                <div class="legendItem"><span class="swatch sw-main"></span> Sonne / Mond</div>
                <div class="legendItem"><span class="swatch sw-angle"></span> Aszendent / Medium Coeli</div>
                <div class="legendItem"><span class="swatch sw-planet"></span> Planeten</div>
              </div>

              <div class="hint">
                Darstellung: 0° Widder rechts. 12 Segmente à 30°. Marker stehen auf ihrer Position.
                Details stehen in den Tabellen (ohne Textgewirr im Rad).
              </div>
            </div>
          </div>

          <div class="panel">
            <div style="font-weight:700;">Planetenübersicht</div>
            <div class="hint">Sortiert nach Position (0–360°). Haus wird berechnet, wenn Häuser im Ergebnis vorhanden sind.</div>

            <div class="tableWrap" style="margin-top:10px;">
              <table id="planetTable">
                <thead>
                  <tr>
                    <th>Körper</th>
                    <th>Zeichen</th>
                    <th class="mono">Grad im Zeichen</th>
                    <th class="mono">Längengrad</th>
                    <th>Haus</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div style="margin-top:14px; font-weight:700;">Häuser</div>
            <div class="hint">Hausspitzen (1–12). Haus 1 startet beim Aszendenten (Cusp 1).</div>

            <div class="tableWrap" style="margin-top:10px;">
              <table id="houseTable">
                <thead>
                  <tr>
                    <th>Haus</th>
                    <th>Zeichen</th>
                    <th class="mono">Grad im Zeichen</th>
                    <th class="mono">Längengrad</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="sectionTitle">JSON</div>
        <pre id="outJson">{}</pre>

        <div class="sectionTitle">Hinweise / Issues</div>
        <pre id="outIssues">[]</pre>
      </section>
    </div>
  </div>

  <script defer src="/demo.js"></script>
</body>
</html>
